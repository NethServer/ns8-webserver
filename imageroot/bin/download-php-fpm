#!/bin/bash

#
# Copyright (C) 2022 Nethesis S.r.l.
# SPDX-License-Identifier: GPL-3.0-or-later
#
set -e
# we download image and tag it with major version

minor_version="${1:?We expect one argument}"

# retrieve environment IMAGE_URL, remove the registry if present and keep the tag, e.g. `1.1.1`
image_url="${IMAGE_URL:-? We expect IMAGE_URL environment variable}"
# remove `ghcr.io/nethserver/webserver:`
tag="${image_url##*:}"

# save the php tag for later use in the systemd service
echo "IMAGE_URL_TAG=$tag" > image_url_tag.env

# pull the image
podman-pull-missing "ghcr.io/nethserver/php$minor_version-fpm:$tag"
